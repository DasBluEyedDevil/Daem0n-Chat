---
phase: 08-adaptive-personality
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - daem0nmcp/tools/daem0n_briefing.py
  - daem0nmcp/tools/daem0n_profile.py
  - tests/test_daem0n_tools.py
autonomous: true

must_haves:
  truths:
    - "Briefing response includes style_guidance field when user has >= 5 analyzed messages"
    - "Briefing omits style_guidance when user has < 5 analyzed messages or no style memory"
    - "style_guidance contains qualitative natural-language tone suggestions, not numeric scores"
    - "Introspect action shows style profile alongside other category data"
    - "Style guidance appears in all three briefing paths (new device excluded, unnamed user included, returning user included)"
  artifacts:
    - path: "daem0nmcp/tools/daem0n_briefing.py"
      provides: "Style guidance in briefing response"
      contains: "style_guidance"
    - path: "daem0nmcp/tools/daem0n_profile.py"
      provides: "Style profile display in introspect"
      contains: "style_profile"
  key_links:
    - from: "daem0nmcp/tools/daem0n_briefing.py"
      to: "daem0nmcp/style_detect.py"
      via: "import load_style_profile, build_style_guidance"
      pattern: "load_style_profile|build_style_guidance"
    - from: "daem0nmcp/tools/daem0n_profile.py"
      to: "daem0nmcp/style_detect.py"
      via: "import load_style_profile for introspect display"
      pattern: "load_style_profile"
---

<objective>
Surface style guidance in the briefing and show the style profile in introspect.

Purpose: Complete the adaptive personality loop -- Plan 01 detects and stores style, this plan surfaces it so Claude actually adapts. Also adds visibility so users can see their style profile via introspect.

Output: Briefing includes `style_guidance` for returning users with enough message history. Introspect shows the style profile breakdown.
</objective>

<execution_context>
@C:\Users\dasbl\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dasbl\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-adaptive-personality/08-RESEARCH.md
@.planning/phases/08-adaptive-personality/08-01-SUMMARY.md

Key codebase files to reference:
@daem0nmcp/tools/daem0n_briefing.py — Hook point: load style profile and add guidance in _build_user_briefing()
@daem0nmcp/tools/daem0n_profile.py — Hook point: add style_profile to introspect action response
@daem0nmcp/style_detect.py — Created in Plan 01, provides load_style_profile and build_style_guidance
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add style_guidance to briefing</name>
  <files>daem0nmcp/tools/daem0n_briefing.py</files>
  <action>
**Import additions (at top, in both try/except blocks):**
Add imports for `load_style_profile` and `build_style_guidance` from `style_detect` module. Follow the existing import pattern (try relative, except absolute).

**Modification to _build_user_briefing():**
After the thread surfacing guidance block (end of the function, around line 816) and before `return response`, add:

```python
# 8. Style adaptation guidance
style_profile = await load_style_profile(ctx, user_name)
if style_profile:
    style_guidance = build_style_guidance(style_profile)
    if style_guidance:
        response["style_guidance"] = style_guidance
```

This loads the style profile (created by Plan 01's remember hook) and generates natural-language guidance only when sufficient data exists (>=5 messages, handled inside build_style_guidance).

**Modification to unnamed user briefing path (all_default block, ~line 460):**
After the `claude_statement_tracking` assignment and before `return briefing`, add the same style guidance loading:

```python
# Style guidance for unnamed user
style_profile = await load_style_profile(ctx, "default")
if style_profile:
    style_guidance = build_style_guidance(style_profile)
    if style_guidance:
        briefing["style_guidance"] = style_guidance
```

**No modification to new device path (total_memories == 0):** Brand new devices have no style data, so no style guidance is needed. The absence of style_guidance is correct for first sessions.

The style_guidance field surfaces as part of the briefing response alongside greeting_guidance, auto_detection_guidance, etc. Claude reads it and adjusts its tone accordingly.
  </action>
  <verify>
Grep `daem0n_briefing.py` for "style_guidance" -- appears in both _build_user_briefing and unnamed user path.
Grep `daem0n_briefing.py` for "load_style_profile" -- import exists.
  </verify>
  <done>Briefing includes style_guidance for returning users and unnamed users when style profile has enough data. New device path correctly omits it.</done>
</task>

<task type="auto">
  <name>Task 2: Show style profile in introspect and add tests</name>
  <files>daem0nmcp/tools/daem0n_profile.py, tests/test_daem0n_tools.py</files>
  <action>
**daem0n_profile.py modifications:**

Add import for `load_style_profile` from style_detect (in both try/except blocks, matching existing import pattern).

In the `introspect` action handler (line ~309), after the existing introspection query builds the `by_category` dict and BEFORE the return statement, add:

```python
# Load style profile if available
try:
    from ..style_detect import load_style_profile
except ImportError:
    from daem0nmcp.style_detect import load_style_profile

style_profile = await load_style_profile(ctx, current)
style_data = None
if style_profile:
    style_data = {
        "formality": style_profile.formality,
        "verbosity": style_profile.verbosity,
        "emoji_usage": style_profile.emoji_usage,
        "expressiveness": style_profile.expressiveness,
        "messages_analyzed": style_profile.message_count,
    }
    # Add human-readable labels
    labels = {}
    if style_profile.formality < 0.3:
        labels["formality"] = "very casual"
    elif style_profile.formality < 0.5:
        labels["formality"] = "casual"
    elif style_profile.formality > 0.7:
        labels["formality"] = "formal"
    else:
        labels["formality"] = "neutral"

    if style_profile.verbosity < 0.25:
        labels["verbosity"] = "terse"
    elif style_profile.verbosity > 0.7:
        labels["verbosity"] = "verbose"
    else:
        labels["verbosity"] = "moderate"

    if style_profile.emoji_usage > 0.5:
        labels["emoji"] = "regular emoji user"
    elif style_profile.emoji_usage > 0.2:
        labels["emoji"] = "occasional emoji"
    else:
        labels["emoji"] = "rarely/never uses emoji"

    if style_profile.expressiveness > 0.6:
        labels["expressiveness"] = "highly expressive"
    elif style_profile.expressiveness < 0.2:
        labels["expressiveness"] = "understated"
    else:
        labels["expressiveness"] = "moderate"

    style_data["labels"] = labels
```

Then add `"style_profile": style_data` to the return dict (alongside existing fields like by_category, permanent_count, etc.). Only include it when style_data is not None.

**Tests to add (in tests/test_daem0n_tools.py):**

Add to the existing `TestStyleDetection` class (or create `TestStyleBriefingIntegration` if cleaner):

1. **test_briefing_includes_style_guidance**: Create a mock style memory (tags=["profile","style"], content=JSON with formality=0.2, verbosity=0.3, emoji_usage=0.0, expressiveness=0.2, message_count=10). Run briefing for a returning user with memories. Verify response contains "style_guidance" key and the guidance text contains "casual" (since formality=0.2 < 0.3).

2. **test_briefing_omits_style_guidance_insufficient_messages**: Create style memory with message_count=3. Run briefing. Verify "style_guidance" NOT in response.

3. **test_briefing_omits_style_guidance_no_style_memory**: User with regular memories but no style memory. Run briefing. Verify "style_guidance" NOT in response.

4. **test_introspect_includes_style_profile**: Create style memory for user. Call daem0n_profile(action='introspect'). Verify response contains "style_profile" with formality, verbosity, emoji_usage, expressiveness, messages_analyzed fields.

5. **test_introspect_style_profile_labels**: Create style memory with formality=0.2. Call introspect. Verify style_profile["labels"]["formality"] == "very casual".

6. **test_introspect_no_style_profile**: User with no style memory. Call introspect. Verify "style_profile" is None in response.

7. **test_style_guidance_text_format**: Create StyleProfile with formality=0.2, verbosity=0.15, emoji_usage=0.6, expressiveness=0.7, message_count=10. Call build_style_guidance(). Verify output starts with "COMMUNICATION STYLE ADAPTATION:" and ends with "Adapt naturally" caveat.

Run full test suite to confirm no regressions.
  </action>
  <verify>
`python -m pytest tests/test_daem0n_tools.py -v -k "test_briefing_includes_style or test_briefing_omits_style or test_introspect_includes_style or test_introspect_style or test_introspect_no_style or test_style_guidance_text"` -- all 7 tests pass.
`python -m pytest tests/test_daem0n_tools.py -v` -- full test suite passes with no regressions.
  </verify>
  <done>Briefing surfaces style_guidance for users with enough analyzed messages. Introspect shows style profile with numeric scores and human-readable labels. 7 new tests pass covering guidance inclusion/omission, introspect display, label mapping, and format. No test regressions.</done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/test_daem0n_tools.py -v -k "style"` -- all style-related tests pass (14 from Plan 01 + 7 from Plan 02 = 21 total)
2. `python -m pytest tests/test_daem0n_tools.py -v` -- full suite passes, 0 regressions
3. Grep daem0n_briefing.py for "style_guidance" -- present in both returning user and unnamed user paths
4. Grep daem0n_profile.py for "style_profile" -- present in introspect response
5. style_guidance text is qualitative ("casual", "concise") not quantitative (no raw numbers exposed to Claude)
</verification>

<success_criteria>
- Briefing response includes style_guidance when user has >= 5 analyzed messages with non-neutral scores
- Briefing correctly omits style_guidance for new devices, insufficient data, or neutral profiles
- Style guidance uses natural language buckets, never exposes raw numeric scores to Claude
- Introspect shows style profile with both scores and human-readable labels
- 21 total style tests pass (14 + 7), 0 regressions
- End-to-end flow works: user messages -> daem0n_remember stores style -> briefing reads style -> guidance returned
</success_criteria>

<output>
After completion, create `.planning/phases/08-adaptive-personality/08-02-SUMMARY.md`
</output>
